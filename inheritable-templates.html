<link rel="import" href="../polymer/polymer.html" /><polymer-element name="inheritable-templates" attributes="ids"><script>"use strict";Polymer("inheritable-templates",{ready:function(){this.internalTemplates={},this.externalTemplates={},this.sources={},this.allowedExternalIds={}},attached:function(){this.parent=this.parentNode,this.parent.host&&(this.parent=this.parent.host),this.parentShadow=this.parent.shadowRoot},domReady:function(){this.parentShadow&&(this.attachMutationObservers(),[].filter.call(this.parent.childNodes,this.registerExternalTemplate.bind(this)))},attachMutationObservers:function(){new MutationObserver(this.onMutation.bind(this)).observe(this.parent,{childList:!0})},onMutation:function(t){t.forEach(function(t){[].forEach.call(t.addedNodes,this.registerExternalTemplate.bind(this)),[].forEach.call(t.removedNodes,this.removeExternalTemplate.bind(this))}.bind(this))},registerExternalTemplate:function(t){var e;"TEMPLATE"===t.nodeName&&(e=t.getAttribute("id"))&&!this.externalTemplates[e]&&(this.externalTemplates[e]&&this.parentShadow.removeChild(this.externalTemplates[e]),this.externalTemplates[e]=t.ref_.cloneNode(!0),this.externalTemplates[e].setAttribute("id","external-"+e),this.parentShadow.appendChild(this.externalTemplates[e]),this.useExternal(e))},removeExternalTemplate:function(t){var e;"TEMPLATE"===t.nodeName&&(e=t.getAttribute("id"))&&this.externalTemplates[e]&&(delete this.externalTemplates[e],this.useInternal(e))},idsChanged:function(){"string"==typeof this.ids&&(this.ids=this.ids.split(/\s*,\s*/g));var t=this.allowedExternalIds={};this.ids.forEach(function(e){t[e]=1}),Object.keys(this.sources).forEach(function(e){"internal"===this.sources[e]?t[e]&&this.useExternal(e):t[e]||this.useInternal(e)}.bind(this))},useExternal:function(t){this.setInternalTemplateSource(t,"external")},useInternal:function(t){this.setInternalTemplateSource(t,"internal")},setInternalTemplateSource:function(t,e){if(this.parentShadow)switch(e){case"internal":this.parent.$[t].removeAttribute("ref"),this.sources[t]="internal";break;case"external":if(!this.allowedExternalIds[t]||!this.externalTemplates[t])return;this.parent.$[t].setAttribute("ref","external-"+t),this.sources[t]="external"}}});</script></polymer-element>